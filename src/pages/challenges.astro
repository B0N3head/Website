---
import "@/styles/global.css";
import Navigation from "@/components/Navigation.astro";
import Footer from "@/components/Footer.astro";
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <title>QUT AI & ML Society</title>
  </head>

  <body class="dark background-non-curved-v2">
    <Navigation />

    <div class="hero-section">
      <img src="../../src/styles/network.jpg" alt="Header background" class="hero-background" />
      <div class="hero-overlay"></div>
      <h1 class="hero-heading">Challenges</h1>
    </div>

    <main class="min-h-screen py-12">
      <section class="challenge-table-section">
        <!-- Controls: Search | Filter | Sort -->
        <div class="controls-wrapper flex flex-wrap items-center gap-4 justify-between px-6 mb-8">
          <input
            type="text"
            id="searchInput"
            placeholder="Search challenge name..."
            class="search-bar"
          />

          <div class="filter-buttons flex gap-3">
            <!-- Dropdown trigger -->
            <div class="sort-dropdown-container relative">
              <button id="sortDropdownBtn" class="sort-dropdown-toggle">Sort by â–¾</button>
              <ul id="sortDropdown" class="sort-dropdown-list hidden absolute z-10 mt-2 bg-[#1f1f1f] border border-[#444] rounded-md w-48 text-left text-white">
                <li class="sort-dropdown-item px-4 py-2 cursor-pointer hover:bg-[#333]" data-index="0" data-type="number">Number</li>
                <li class="sort-dropdown-item px-4 py-2 cursor-pointer hover:bg-[#333]" data-index="1" data-type="string">Name</li>
                <li class="sort-dropdown-item px-4 py-2 cursor-pointer hover:bg-[#333]" data-index="2" data-type="difficulty">Difficulty</li>
                <li class="sort-dropdown-item px-4 py-2 cursor-pointer hover:bg-[#333]" data-index="3" data-type="string">Topic</li>
              </ul>
            </div>

            <button class="filter-btn active" data-topic="All">All</button>
            <button class="filter-btn" data-topic="Linear Regression">Linear Regression</button>
            <button class="filter-btn" data-topic="CNN">CNN</button>
            <button class="filter-btn" data-topic="Clustering">Clustering</button>
            <button class="filter-btn" data-topic="PCA">PCA</button>
            <button class="filter-btn" data-topic="Random Forest">Random Forest</button>
          </div>
        </div>

        <!-- Table -->
        <div class="table-wrapper px-6">
          <table class="challenge-table w-full">
            <colgroup>
              <col style="width: 5%;" />     <!-- ID column -->
              <col style="width: 60%;" />    <!-- Project name -->
              <col style="width: 15%;" />    <!-- Difficulty -->
              <col style="width: 20%;" />    <!-- Topic -->
            </colgroup>
           <tbody>
              <tr data-topic="Linear Regression" onclick="window.location.href='https://TESTLINK.com';" style="cursor: pointer;">
                <td>1</td>
                <td>Best Selling Games of All Time</td>
                <td style="color:forestgreen">Beginner</td>
                <td>Linear Regression</td>
              </tr>
              <tr data-topic="Linear Regression" onclick="window.location.href='https://TESTLINK.com';" style="cursor: pointer;">
                <td>2</td>
                <td>Formula 1 World Championships</td>
                <td style="color:forestgreen">Beginner</td>
                <td>Linear Regression</td>
              </tr>
              <tr data-topic="Linear Regression" onclick="window.location.href='https://TESTLINK.com';" style="cursor: pointer;">
                <td>3</td>
                <td>Global Job Market</td>
                <td style="color:forestgreen">Beginner</td>
                <td>Linear Regression</td>
              </tr>
              <tr data-topic="Linear Regression" onclick="window.location.href='https://TESTLINK.com';" style="cursor: pointer;">
                <td>4</td>
                <td>Smartphone Feature Analysis</td>
                <td style="color:forestgreen">Beginner</td>
                <td>Linear Regression</td>
              </tr>
              <tr data-topic="Linear Regression" onclick="window.location.href='https://TESTLINK.com';" style="cursor: pointer;">
                <td>5</td>
                <td>Retail Market Trends</td>
                <td style="color:forestgreen">Beginner</td>
                <td>Linear Regression</td>
              </tr>
              <tr data-topic="CNN" onclick="window.location.href='https://TESTLINK.com';" style="cursor: pointer;">
                <td>6</td>
                <td>Concrete Crack Detection</td>
                <td style="color:goldenrod">Intermediate</td>
                <td>CNN</td>
              </tr>
              <tr data-topic="CNN" onclick="window.location.href='https://TESTLINK.com';" style="cursor: pointer;">
                <td>7</td>
                <td>Cats vs Dogs</td>
                <td style="color:goldenrod">Intermediate</td>
                <td>CNN</td>
              </tr>
              <tr data-topic="CNN" onclick="window.location.href='https://TESTLINK.com';" style="cursor: pointer;">
                <td>8</td>
                <td>Garbage Detection</td>
                <td style="color:goldenrod">Intermediate</td>
                <td>CNN</td>
              </tr>
              <tr data-topic="CNN" onclick="window.location.href='https://TESTLINK.com';" style="cursor: pointer;">
                <td>9</td>
                <td>Vehicle Detection</td>
                <td style="color:goldenrod">Intermediate</td>
                <td>CNN</td>
              </tr>
              <tr data-topic="CNN" onclick="window.location.href='https://TESTLINK.com';" style="cursor: pointer;">
                <td>10</td>
                <td>Early Disease Detection</td>
                <td style="color:goldenrod">Intermediate</td>
                <td>CNN</td>
              </tr>
              <tr data-topic="PCA" onclick="window.location.href='https://TESTLINK.com';" style="cursor: pointer;">
                <td>11</td>
                <td>Climate Pattern Analysis</td>
                <td style="color:forestgreen">Beginner</td>
                <td>PCA</td>
              </tr>
              <tr data-topic="Clustering" onclick="window.location.href='https://TESTLINK.com';" style="cursor: pointer;">
                <td>12</td>
                <td>Cybersecurity Attack</td>
                <td style="color:forestgreen">Beginner</td>
                <td>Clustering</td>
              </tr>
              <tr data-topic="CNN" onclick="window.location.href='https://TESTLINK.com';" style="cursor: pointer;">
                <td>13</td>
                <td>Traffic SIgn Detection</td>
                <td style="color:goldenrod">Intermediate</td>
                <td>CNN</td>
              </tr>
              <tr data-topic="CNN" onclick="window.location.href='https://TESTLINK.com';" style="cursor: pointer;">
                <td>14</td>
                <td>Traffic SIgn Detection</td>
                <td style="color:goldenrod">Intermediate</td>
                <td>CNN</td>
              </tr>
              <tr data-topic="Random Forest" onclick="window.location.href='https://TESTLINK.com';" style="cursor: pointer;">
                <td>15</td>
                <td>Movie Genre Classification</td>
                <td style="color:goldenrod">Intermediate</td>
                <td>Random Forest</td>
              </tr>
              <tr data-topic="Random Forest" onclick="window.location.href='https://TESTLINK.com';" style="cursor: pointer;">
                <td>16</td>
                <td>Customer Churn Predictions</td>
                <td style="color:goldenrod">Intermediate</td>
                <td>Random Forest</td>
              </tr>
              <tr data-topic="Random Forest" onclick="window.location.href='https://TESTLINK.com';" style="cursor: pointer;">
                <td>17</td>
                <td>Air Quality Predictions</td>
                <td style="color:goldenrod">Intermediate</td>
                <td>Random Forest</td>
              </tr>
            </tbody>

          </table>
        </div>
      </section>
      </main>

    <Footer />
  </body>
</html>



<script>
  const filterButtons = document.querySelectorAll('.filter-btn[data-topic]');
  const searchInput = document.getElementById('searchInput');
  const tbody = document.querySelector('.challenge-table tbody');
  const dropdownBtn = document.querySelector('.sort-dropdown-toggle');
  const dropdown = document.querySelector('.sort-dropdown-list');
  const sortOptions = dropdown.querySelectorAll('.sort-dropdown-item');
  const rows = () => Array.from(tbody.querySelectorAll('tr'));
  const headers = ['number', 'name', 'difficulty', 'topic']; // purely for sort labels

  let activeTopic = 'All';
  let sortState = {};

  const difficultyOrder = { Beginner: 1, intermediate: 2, advanced: 3 };

  function filterRows() {
    const query = searchInput.value.toLowerCase();
    rows().forEach(row => {
      const topic = row.getAttribute('data-topic');
      const name = row.cells[1].textContent.toLowerCase();
      const topicMatch = activeTopic === 'All' || topic === activeTopic;
      const searchMatch = name.includes(query);
      row.style.display = topicMatch && searchMatch ? '' : 'none';
    });
  }

  function sortTable(index, type) {
    const rowList = rows();
    const isAsc = sortState[index] === 'asc';
    sortState = {}; // Reset other sort states
    sortState[index] = isAsc ? 'desc' : 'asc';

    rowList.sort((a, b) => {
      const aVal = a.cells[index].textContent.trim().toLowerCase();
      const bVal = b.cells[index].textContent.trim().toLowerCase();

      if (type === 'number') return isAsc ? bVal - aVal : aVal - bVal;
      if (type === 'difficulty') {
        return isAsc
          ? difficultyOrder[bVal] - difficultyOrder[aVal]
          : difficultyOrder[aVal] - difficultyOrder[bVal];
      }

      return isAsc
        ? bVal.localeCompare(aVal)
        : aVal.localeCompare(bVal);
    });

    rowList.forEach(row => tbody.appendChild(row));
    filterRows(); // Preserve filters post-sort
  }

  filterButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelector('.filter-btn.active')?.classList.remove('active');
      btn.classList.add('active');
      activeTopic = btn.getAttribute('data-topic');
      filterRows();
    });
  });

  searchInput.addEventListener('input', filterRows);

  dropdownBtn.addEventListener('click', () => {
    dropdown.classList.toggle('show');
  });

  sortOptions.forEach(option => {
    option.addEventListener('click', () => {
      const index = parseInt(option.getAttribute('data-index'));
      const type = option.getAttribute('data-type');
      sortTable(index, type);
      dropdown.classList.remove('show');
    });
  });

  document.addEventListener('click', e => {
    if (!dropdown.contains(e.target) && e.target !== dropdownBtn) {
      dropdown.classList.remove('show');
    }
  });
</script>
